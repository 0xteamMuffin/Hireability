// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  
  firstName String?
  lastName  String?
  bio       String?
  avatarUrl String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile        UserProfile?
  documents      Document[]
  targetCompanies TargetCompany[]
  settings       UserSettings?

  @@map("users")
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  targetRole    String?
  targetCompany String?
  level         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_profiles")
}

// ===========================================
// AGENTIC PARSER - Simple & Generic
// ===========================================

model Document {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      DocumentType
  fileName  String
  mimeType  String?
  rawText   String?
  
  // Processing
  status     ProcessingStatus @default(PENDING)
  parsedData Json?
  
  // Agent metadata
  agentVersion String?
  confidence   Float?
  tokenUsage   Int?
  processedAt  DateTime?
  error        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("documents")
}

enum DocumentType {
  RESUME
  JOB_DESCRIPTION
  OTHER
}

enum ProcessingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model TargetCompany {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyName  String
  role         String
  companyEmail String?
  websiteLink  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("target_companies")
}

model UserSettings {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  notifications Boolean @default(true)
  darkMode      Boolean @default(false)
  language      String  @default("en")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_settings")
}
